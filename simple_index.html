<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Input Runner (Classic 2018)</title>
  <meta name="viewport" content="width=540">
  <style>
    body { background: #222; color: #bfffb2; font-family: sans-serif; margin:0;}
    .input-row { display:flex; flex-wrap:wrap; gap:7px; justify-content:center; margin:30px 0;}
    .input-btn { width:58px; height:58px; border-radius:7px; background:#232; color:#bfffb2; border:2px solid #232; font-weight:bold; display:flex;align-items:center;justify-content:center; cursor:pointer; }
    .input-btn.selected,.input-btn:focus { background:#aeffb7; color:#151; border:2px solid #aeffb7;}
    .input-extra { background:#232; color:#fff; border-radius:4px; padding:2px 10px; margin:2px 0; font-size:.99em;}
    .modal-bg{position:fixed; inset:0; background:#181a1bcc; display:flex; align-items:center; justify-content:center;}
    .modal-bg video{width:70vw; height:55vw; max-width:99vw; max-height:60vh; background:#100;}
  </style>
</head>
<body>
  <div id="app"></div>
  <script type="module">
    const INPUTS = [
      {key:"hdmi1",label:"HDMI 1",src:"ext://hdmi:1"},
      {key:"hdmi2",label:"HDMI 2",src:"ext://hdmi:2"},
      {key:"av1",label:"AV 1",src:"ext://av:1"},
      {key:"av2",label:"AV 2",src:"ext://av:2"},
      {key:"comp1",label:"COMP 1",src:"ext://comp:1"},
      {key:"scart1",label:"SCART 1",src:"ext://scart:1"},
      {key:"tv1",label:"TV 1",src:"atv://cable:1/dvb/1"},
      {key:"tv2",label:"TV 2",src:"atv://cable:2/dvb/2"}
    ];
    const $ = s=>document.querySelector(s);
    let state={sel:0,show:false,vid:0,exts:[]};
    function render() {
      $('#app').innerHTML = `
        <div>
          <div class="input-row">${
            INPUTS.map((inp,i)=>`
              <div class="input-btn${state.sel===i&&!state.show?" selected":""}"
                tabindex="0"
                onclick="app.pickInput(${i})"
                ${state.sel===i&&!state.show?'autofocus':''}
              >${inp.label}</div>`).join('')
          }</div>
          <div>${state.exts.map(t=>`<div class="input-extra">${t}</div>`).join('')}</div>
          <div><input id="inpadd" type="text" placeholder="Add Input..." onkeydown="app.addInput(event)" style="background:#232;color:#bfffb2;border:1px solid #333;border-radius:4px;padding:5px 7px;margin:12px 1px 0 0;"></div>
        </div>
        ${state.show?`<div class="modal-bg" onclick="app.close(event)">
          <video autoplay controls><source src="${INPUTS[state.vid].src}" type="service/webos-external"></video>
        </div>`:''}
      `;
    }
    window.app = {
      pickInput(idx){state.sel=idx;state.vid=idx;state.show=true;render();},
      close(e){if(e.target!==e.currentTarget)return;state.show=false;render();},
      addInput(e){if(e.key==='Enter'){let v=e.target.value.trim();if(v){state.exts.push(v);render();}e.target.value='';}}
    };
    document.addEventListener('keydown',e=>{
      if(state.show&&(e.key==="Backspace"||e.key==="Escape"||e.keyCode===461)) {state.show=false;render();e.preventDefault();return;}
      if(document.activeElement.tagName==="INPUT")return;
      if(e.key==="ArrowLeft"){state.sel=(state.sel-1+INPUTS.length)%INPUTS.length;render();e.preventDefault();}
      else if(e.key==="ArrowRight"){state.sel=(state.sel+1)%INPUTS.length;render();e.preventDefault();}
      else if(e.key==="Enter"){app.pickInput(state.sel);e.preventDefault();}
    });
    render();
  </script>
</body>
</html>
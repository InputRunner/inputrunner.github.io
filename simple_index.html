<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Input Runner (Simple Player)</title>
  <style>
    body { 
      background: #111; 
      color: #afa; 
      font-family: Arial, sans-serif; 
    }
    .row { 
      margin: 16px 0; 
    }
    .input-btn { 
      background: #222; 
      color: #afa; 
      border: 1px solid #333; 
      border-radius: 2px; 
      padding: 12px 14px; 
      margin: 2px; 
      cursor: pointer; 
    }
    .input-btn.active, .input-btn:focus { 
      background: #0b0; 
      color: #111; 
      border-color: #7f7; 
      outline: none; 
    }
    .player-modal { 
      position: fixed; 
      top: 0; 
      left: 0; 
      width: 100vw; 
      height: 100vh; 
      z-index: 999; 
      background: #000a; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      justify-content: center;
    }
    .close-hint { 
      color: #ddb; 
      padding: 6px; 
      font-size: 13px; 
    }
  </style>
</head>
<body>
  <h2>Input Runner (Simple Player)</h2>
  <div id="inputList" tabindex="0">
    <div class="row">
      <button class="input-btn" data-src="ext://hdmi:1">HDMI 1</button>
      <button class="input-btn" data-src="ext://hdmi:2">HDMI 2</button>
      <button class="input-btn" data-src="ext://hdmi:3">HDMI 3</button>
      <button class="input-btn" data-src="ext://hdmi:4">HDMI 4</button>
    </div>
    <div class="row">
      <button class="input-btn" data-src="ext://comp:1">Component 1</button>
      <button class="input-btn" data-src="ext://av:1">AV 1</button>
      <button class="input-btn" data-src="ext://av:2">AV 2</button>
      <button class="input-btn" data-src="ext://scart:1">SCART 1</button>
    </div>
    <div class="row">
      <button class="input-btn" data-src="atv://cable:1/dvb/1">Live TV 1</button>
      <button class="input-btn" data-src="atv://cable:2/dvb/2">Live TV 2</button>
    </div>
  </div>

  <div id="playerModal" class="player-modal" style="display:none">
    <div id="playerLabel"></div>
    <video id="playerVideo" autoplay controls style="width: 50%; height: 50%;">
      <source id="playerSource" type="service/webos-external">
    </video>
    <div class="close-hint">
      (BACKSPACE/BACK/ESC = Exit, Page Up/Down = Size)
    </div>
  </div>

  <!-- Raw video tags requested to be present in HTML -->
  <video autoplay style="width:50%;height:50%">
    <source type="service/webos-external" src="ext://scart:1"></source>
  </video>

  <video autoplay style="width:50%;height:50%">
    <source type="service/webos-external" src="atv://cable:1/dvb/1"></source>
  </video>

  <video autoplay style="width:50%;height:50%">
    <source type="service/webos-external" src="atv://cable:2/dvb/2"></source>
  </video>

  <script>
    // --- References and setup
    var inputList = document.getElementById('inputList');
    var playerModal = document.getElementById('playerModal');
    var playerVideo = document.getElementById('playerVideo');
    var playerSource = document.getElementById('playerSource');
    var playerLabel = document.getElementById('playerLabel');
    var inputBtns = Array.prototype.slice.call(document.querySelectorAll('.input-btn'));
    var focusedIdx = 0;
    var playerSizes = [
      {w: "32vw", h: "28vh"}, // small
      {w: "50vw", h: "50vh"}, // normal
      {w: "80vw", h: "80vh"}, // big
    ];
    var playerSizeIdx = 1;
    var playerIsOpen = false;

    // --- Set initial focus
    setActiveBtn(0);

    // --- Input selection by arrow keys
    function setActiveBtn(idx) {
      inputBtns.forEach(function (btn, i) {
        if (i === idx) {
          btn.classList.add("active");
          btn.focus();
        } else {
          btn.classList.remove("active");
        }
      });
      focusedIdx = idx;
    }

    // --- Enter/Click to play
    function openPlayer(idx) {
      var btn = inputBtns[idx];
      var src = btn.getAttribute('data-src');
      var name = btn.textContent;
      playerSource.src = src;
      playerVideo.load();
      playerLabel.textContent = name;
      playerModal.style.display = "";
      playerSizeIdx = 1;
      setPlayerSize(playerSizeIdx);
      playerVideo.focus();
      playerIsOpen = true;
    }

    // --- Keyboard navigation for input select
    inputList.addEventListener('keydown', function (e) {
      if (playerIsOpen) return;
      if (e.key === "ArrowRight" || e.key === "ArrowDown") {
        var next = (focusedIdx + 1) % inputBtns.length;
        setActiveBtn(next);
        e.preventDefault();
      } else if (e.key === "ArrowLeft" || e.key === "ArrowUp") {
        var prev = (focusedIdx - 1 + inputBtns.length) % inputBtns.length;
        setActiveBtn(prev);
        e.preventDefault();
      } else if (e.key === "Enter" || e.key === " ") {
        openPlayer(focusedIdx);
        e.preventDefault();
      }
    });

    // --- Mouse click
    inputBtns.forEach(function (btn, idx) {
      btn.addEventListener('click', function () {
        setActiveBtn(idx);
        openPlayer(idx);
      });
      btn.addEventListener('focus', function () { setActiveBtn(idx); });
    });

    // --- Player control
    function setPlayerSize(idx) {
      idx = Math.max(0, Math.min(2, idx));
      playerSizeIdx = idx;
      var sz = playerSizes[idx];
      playerVideo.style.width = sz.w;
      playerVideo.style.height = sz.h;
    }
    function exitPlayer() {
      playerModal.style.display = "none";
      playerVideo.pause();
      playerIsOpen = false;
      // return focus to list
      inputList.focus();
      setActiveBtn(focusedIdx);
    }
    // Keyboard controls for player
    document.addEventListener('keydown', function (e) {
      if (playerIsOpen) {
        if (
          e.key === "Backspace" ||
          e.key === "Escape" ||
          e.key === "VK_BACK" ||
          e.key === "BACK" ||
          e.keyCode === 461 ||
          e.keyCode === 412
        ) {
          exitPlayer();
          e.preventDefault();
          return;
        }
        if (e.key === "PageUp" || e.keyCode === 33) {
          setPlayerSize(Math.min(playerSizeIdx + 1, 2));
          e.preventDefault();
        }
        if (e.key === "PageDown" || e.keyCode === 34) {
          setPlayerSize(Math.max(playerSizeIdx - 1, 0));
          e.preventDefault();
        }
      }
    });
    // Optional: click modal background exits
    playerModal.addEventListener('click', function (e) {
      if (e.target === playerModal) exitPlayer();
    });

    // For old browsers, ensure inputList can be focused
    inputList.setAttribute("tabindex", "0");
    // Focus input list at load
    window.onload = function () {
      inputList.focus();
      setActiveBtn(0);
    };
  </script>
</body>
</html>
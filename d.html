<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebOS Multi-Source Console</title>
    
    <style>
        /* Base styles for high compatibility */
        body {
            background-color: #111; /* Darker background */
            color: #fff;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent scrolling */
        }
        
        /* Main Container for the 4x2 layout */
        .main-container {
            display: flex;
            flex-wrap: wrap;
            width: 100vw;
            height: 100vh;
        }

        /* Styling for each video card - 4 columns, 2 rows */
        .video-card {
            width: 25%;
            height: 50%;
            box-sizing: border-box; /* Include padding in width/height */
            padding: 5px; /* Minimal gap */
            background-color: #1f2937; /* Dark gray card background */
            position: relative;
        }

        /* Specific style for the Broadcast TV card */
        .broadcast-card {
            background-color: #1e3a8a; /* Dark blue for distinction */
        }

        /* Header styling */
        .card-header {
            font-size: 0.875rem;
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Text states */
        .state-muted { color: #f87171; /* Red */ }
        .state-unmuted { color: #34d399; /* Green */ }
        .source-text {
            font-size: 0.75rem;
            color: #9ca3af; /* Light gray text */
            margin-top: 3px;
        }

        /* Define a 16:9 aspect ratio container for the video elements */
        .video-container {
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio (9/16 * 100) */
            position: relative;
        }

        /* Video element must fill its container */
        .video-element {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 4px;
            background-color: #000;
        }

        /* Overlay for "No Signal" message */
        .signal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            color: #ff3838; /* Brighter red */
            display: none;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: 800;
            border-radius: 4px;
            z-index: 10;
        }

        /* Indicator for which video is currently unmuted */
        .unmuted-indicator {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background-color: #22c55e;
            display: none;
            z-index: 20;
            box-shadow: 0 0 10px #22c55e;
        }
    </style>
</head>
<body>

    <div class="main-container">

        <!-- All video cards use data-key attribute for JS mapping -->

        <!-- 1. HDMI 1 -->
        <div class="video-card" data-key="1">
            <h2 class="card-header">
                <span>[1] HDMI 1</span> <span id="key-1-state" class="state-muted">MUTED</span>
            </h2>
            <div class="video-container">
                <video id="video-1" class="video-element" autoplay muted></video>
                <div id="overlay-1" class="signal-overlay">NO SIGNAL</div>
                <div id="indicator-1" class="unmuted-indicator"></div>
            </div>
            <p class="source-text">Source: ext://hdmi:1</p>
        </div>

        <!-- 2. HDMI 2 -->
        <div class="video-card" data-key="2">
            <h2 class="card-header">
                <span>[2] HDMI 2</span> <span id="key-2-state" class="state-muted">MUTED</span>
            </h2>
            <div class="video-container">
                <video id="video-2" class="video-element" autoplay muted></video>
                <div id="overlay-2" class="signal-overlay">NO SIGNAL</div>
                <div id="indicator-2" class="unmuted-indicator"></div>
            </div>
            <p class="source-text">Source: ext://hdmi:2</p>
        </div>

        <!-- 3. HDMI 3 -->
        <div class="video-card" data-key="3">
            <h2 class="card-header">
                <span>[3] HDMI 3</span> <span id="key-3-state" class="state-muted">MUTED</span>
            </h2>
            <div class="video-container">
                <video id="video-3" class="video-element" autoplay muted></video>
                <div id="overlay-3" class="signal-overlay">NO SIGNAL</div>
                <div id="indicator-3" class="unmuted-indicator"></div>
            </div>
            <p class="source-text">Source: ext://hdmi:3</p>
        </div>

        <!-- 4. HDMI 4 -->
        <div class="video-card" data-key="4">
            <h2 class="card-header">
                <span>[4] HDMI 4</span> <span id="key-4-state" class="state-muted">MUTED</span>
            </h2>
            <div class="video-container">
                <video id="video-4" class="video-element" autoplay muted></video>
                <div id="overlay-4" class="signal-overlay">NO SIGNAL</div>
                <div id="indicator-4" class="unmuted-indicator"></div>
            </div>
            <p class="source-text">Source: ext://hdmi:4</p>
        </div>

        <!-- 5. Component 1 -->
        <div class="video-card" data-key="5">
            <h2 class="card-header">
                <span>[5] Component 1</span> <span id="key-5-state" class="state-muted">MUTED</span>
            </h2>
            <div class="video-container">
                <video id="video-5" class="video-element" autoplay muted></video>
                <div id="overlay-5" class="signal-overlay">NO SIGNAL</div>
                <div id="indicator-5" class="unmuted-indicator"></div>
            </div>
            <p class="source-text">Source: ext://comp:1</p>
        </div>

        <!-- 6. AV 1 (Composite) -->
        <div class="video-card" data-key="6">
            <h2 class="card-header">
                <span>[6] AV 1</span> <span id="key-6-state" class="state-muted">MUTED</span>
            </h2>
            <div class="video-container">
                <video id="video-6" class="video-element" autoplay muted></video>
                <div id="overlay-6" class="signal-overlay">NO SIGNAL</div>
                <div id="indicator-6" class="unmuted-indicator"></div>
            </div>
            <p class="source-text">Source: ext://av:1</p>
        </div>

        <!-- 7. AV 2 (Composite) -->
        <div class="video-card" data-key="7">
            <h2 class="card-header">
                <span>[7] AV 2</span> <span id="key-7-state" class="state-muted">MUTED</span>
            </h2>
            <div class="video-container">
                <video id="video-7" class="video-element" autoplay muted></video>
                <div id="overlay-7" class="signal-overlay">NO SIGNAL</div>
                <div id="indicator-7" class="unmuted-indicator"></div>
            </div>
            <p class="source-text">Source: ext://av:2</p>
        </div>

        <!-- 8. Broadcast TV -->
        <div class="video-card broadcast-card" data-key="8">
            <h2 class="card-header">
                <span>[8] Broadcast TV</span> <span id="key-8-state" class="state-muted">MUTED</span>
            </h2>
            <div class="video-container">
                <video id="video-8" class="video-element" autoplay muted></video>
                <div id="overlay-8" class="signal-overlay">NO SIGNAL</div>
                <div id="indicator-8" class="unmuted-indicator"></div>
            </div>
            <p class="source-text">Source: tv://cable:1</p>
        </div>

    </div>

    <!-- Hidden element to hold the source data -->
    <div id="source-data" style="display: none;">
        <source data-id="1" type="service/webos-external" src="ext://hdmi:1">
        <source data-id="2" type="service/webos-external" src="ext://hdmi:2">
        <source data-id="3" type="service/webos-external" src="ext://hdmi:3">
        <source data-id="4" type="service/webos-external" src="ext://hdmi:4">
        <source data-id="5" type="service/webos-external" src="ext://comp:1">
        <source data-id="6" type="service/webos-external" src="ext://av:1">
        <source data-id="7" type="service/webos-external" src="ext://av:2">
        <source data-id="8" type="service/webos-broadcast" src="tv://cable:1">
    </div>

    <script>
        // Define the time to wait before assuming 'No Signal' (in milliseconds)
        var SIGNAL_TIMEOUT_MS = 1500;
        var NUM_SOURCES = 8;
        var videoElements = {};
        var overlayElements = {};
        var stateElements = {};
        var indicatorElements = {};

        // --- Initialization and Source Loading ---

        window.onload = function() {
            // Load sources into video elements
            var sources = document.querySelectorAll('#source-data source');
            sources.forEach(function(source) {
                var id = source.dataset.id;
                var video = document.getElementById('video-' + id);
                
                if (video) {
                    // Create the actual <source> tag inside the video element
                    var sourceTag = document.createElement('source');
                    sourceTag.setAttribute('type', source.getAttribute('type'));
                    sourceTag.setAttribute('src', source.getAttribute('src'));
                    video.appendChild(sourceTag);

                    // Map all relevant elements
                    videoElements[id] = video;
                    overlayElements[id] = document.getElementById('overlay-' + id);
                    stateElements[id] = document.getElementById('key-' + id + '-state');
                    indicatorElements[id] = document.getElementById('indicator-' + id);

                    // Setup signal detection for the newly populated video
                    setupSignalDetection(id);
                }
            });

            // Set up keyboard control listener
            document.addEventListener('keydown', handleKeyToggle);
        };

        // --- Signal Detection Logic ---

        function setupSignalDetection(id) {
            var video = videoElements[id];
            var overlay = overlayElements[id];

            var timeout = setTimeout(function() {
                if (video.paused || video.ended || video.readyState < 3) {
                    overlay.style.display = 'flex';
                }
            }, SIGNAL_TIMEOUT_MS);

            // Function to handle signal loss/end
            var checkSignal = function() {
                clearTimeout(timeout);
                if (video.paused || video.ended || video.readyState < 3) {
                     overlay.style.display = 'flex';
                }
            };

            // Remove overlay when video successfully plays
            video.addEventListener('playing', function() {
                clearTimeout(timeout);
                overlay.style.display = 'none';
            });
            
            // Re-check/re-show signal on playback failure events
            video.addEventListener('ended', checkSignal);
            video.addEventListener('error', checkSignal);
            video.addEventListener('pause', checkSignal);
        }

        // --- Keyboard Control Logic ---

        function handleKeyToggle(event) {
            // Get the key pressed (e.g., '1', '2', '8')
            var key = event.key;
            
            // Check if the key is a number between 1 and 8
            if (key >= '1' && key <= NUM_SOURCES.toString()) {
                var id = key;
                toggleAudio(id);
            }
        }

        function toggleAudio(idToToggle) {
            // Loop through all videos to ensure only ONE is unmuted at a time (like a selector switch)
            for (var i = 1; i <= NUM_SOURCES; i++) {
                var id = i.toString();
                var video = videoElements[id];
                var stateText = stateElements[id];
                var indicator = indicatorElements[id];

                if (!video) continue;

                if (id === idToToggle) {
                    // This is the selected video. Toggle its mute state.
                    video.muted = !video.muted;
                } else {
                    // Mute all other videos
                    video.muted = true;
                }

                // Update UI state
                if (video.muted) {
                    stateText.textContent = 'MUTED';
                    stateText.className = stateText.className.replace('state-unmuted', 'state-muted');
                    indicator.style.display = 'none';
                } else {
                    stateText.textContent = 'UNMUTED';
                    stateText.className = stateText.className.replace('state-muted', 'state-unmuted');
                    indicator.style.display = 'block';
                }
            }
        }
    </script>
</body>
</html>

